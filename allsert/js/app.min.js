var ua = window.navigator.userAgent;
var msie = ua.indexOf("MSIE ");
var isMobile = {
	Android: function () {
		return navigator.userAgent.match(/Android/i);
	},
	BlackBerry: function () {
		return navigator.userAgent.match(/BlackBerry/i);
	},
	iOS: function () {
		return navigator.userAgent.match(/iPhone|iPad|iPod/i);
	},
	Opera: function () {
		return navigator.userAgent.match(/Opera Mini/i);
	},
	Windows: function () {
		return navigator.userAgent.match(/IEMobile/i);
	},
	any: function () {
		return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
	}
};

function isIE() {
	ua = navigator.userAgent;
	var is_ie = ua.indexOf("MSIE ") > -1 || ua.indexOf("Trident/") > -1;
	return is_ie;
}
if (isIE()) {
	document.querySelector('html').classList.add('ie');
}
if (isMobile.any()) {
	document.querySelector('html').classList.add('_touch');
}

// Получить цифры из строки
//parseInt(itemContactpagePhone.replace(/[^\d]/g, ''))

function testWebP(callback) {
	var webP = new Image();
	webP.onload = webP.onerror = function () {
		callback(webP.height == 2);
	};
	webP.src = "data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";
}
testWebP(function (support) {
	if (support === true) {
		document.querySelector('html').classList.add('_webp');
	} else {
		document.querySelector('html').classList.add('_no-webp');
	}
});

function ibg() {
	if (isIE()) {
		let ibg = document.querySelectorAll("._ibg");
		for (var i = 0; i < ibg.length; i++) {
			if (ibg[i].querySelector('img') && ibg[i].querySelector('img').getAttribute('src') != null) {
				ibg[i].style.backgroundImage = 'url(' + ibg[i].querySelector('img').getAttribute('src') + ')';
			}
		}
	}
}
ibg();

window.addEventListener("load", function () {
	if (document.querySelector('.wrapper')) {
		setTimeout(function () {
			document.querySelector('.wrapper').classList.add('_loaded');
		}, 0);
	}
});

let unlock = true;

//=================
//ActionsOnHash
if (location.hash) {
	const hsh = location.hash.replace('#', '');
	if (document.querySelector('.popup_' + hsh)) {
		popup_open(hsh);
	} else if (document.querySelector('div.' + hsh)) {
		_goto(document.querySelector('.' + hsh), 500, '');
	}
}
//=================
//BodyLock
function body_lock(delay) {
	let body = document.querySelector("body");
	if (body.classList.contains('_lock')) {
		body_lock_remove(delay);
	} else {
		body_lock_add(delay);
	}
}

function body_lock_remove(delay) {
	let body = document.querySelector("body");
	if (unlock) {
		let lock_padding = document.querySelectorAll("._lp");
		setTimeout(() => {
			for (let index = 0; index < lock_padding.length; index++) {
				const el = lock_padding[index];
				el.style.paddingRight = '0px';
			}
			body.style.paddingRight = '0px';
			body.classList.remove("_lock");
		}, delay);

		unlock = false;
		setTimeout(function () {
			unlock = true;
		}, delay);
	}
}

function body_lock_add(delay) {
	let body = document.querySelector("body");
	if (unlock) {
		let lock_padding = document.querySelectorAll("._lp");
		for (let index = 0; index < lock_padding.length; index++) {
			const el = lock_padding[index];
			el.style.paddingRight = window.innerWidth - document.querySelector('.wrapper').offsetWidth + 'px';
		}
		body.style.paddingRight = window.innerWidth - document.querySelector('.wrapper').offsetWidth + 'px';
		body.classList.add("_lock");

		unlock = false;
		setTimeout(function () {
			unlock = true;
		}, delay);
	}
}

//=================
//Tabs
let tabs = document.querySelectorAll("._tabs");
for (let index = 0; index < tabs.length; index++) {
	let tab = tabs[index];
	let tabs_items;
	let tabs_blocks;
	if (tabs[index].querySelector('._tabs')) {
		tabs_items = tab.querySelectorAll("._tabs-item:not(._tabs-block ._tabs-item)");
		tabs_blocks = tab.querySelectorAll("._tabs-block:not(._tabs-block ._tabs-block");
	} else {
		tabs_items = tab.querySelectorAll("._tabs-item");
		tabs_blocks = tab.querySelectorAll("._tabs-block");
	}

	for (let index = 0; index < tabs_items.length; index++) {
		let tabs_item = tabs_items[index];
		tabs_item.addEventListener("click", function (e) {
			for (let index = 0; index < tabs_items.length; index++) {
				let tabs_item = tabs_items[index];
				tabs_item.classList.remove('_active');
				tabs_blocks[index].classList.remove('_active');
			}
			tabs_item.classList.add('_active');
			tabs_blocks[index].classList.add('_active');
			e.preventDefault();
		});
	}
}
//=================
/*
Для родителя слойлеров пишем атрибут data-spollers
Для заголовков слойлеров пишем атрибут data-spoller
Если нужно включать\выключать работу спойлеров на разных размерах экранов
пишем параметры ширины и типа брейкпоинта.
Например: 
data-spollers="992,max" - спойлеры будут работать только на экранах меньше или равно 992px
data-spollers="768,min" - спойлеры будут работать только на экранах больше или равно 768px

Если нужно что бы в блоке открывался болько один слойлер добавляем атрибут data-one-spoller
*/

// SPOLLERS
const spollersArray = document.querySelectorAll('[data-spollers]');
if (spollersArray.length > 0) {
	// Получение обычных слойлеров
	const spollersRegular = Array.from(spollersArray).filter(function (item, index, self) {
		return !item.dataset.spollers.split(",")[0];
	});
	// Инициализация обычных слойлеров
	if (spollersRegular.length > 0) {
		initSpollers(spollersRegular);
	}

	// Получение слойлеров с медиа запросами
	const spollersMedia = Array.from(spollersArray).filter(function (item, index, self) {
		return item.dataset.spollers.split(",")[0];
	});

	// Инициализация слойлеров с медиа запросами
	if (spollersMedia.length > 0) {
		const breakpointsArray = [];
		spollersMedia.forEach(item => {
			const params = item.dataset.spollers;
			const breakpoint = {};
			const paramsArray = params.split(",");
			breakpoint.value = paramsArray[0];
			breakpoint.type = paramsArray[1] ? paramsArray[1].trim() : "max";
			breakpoint.item = item;
			breakpointsArray.push(breakpoint);
		});

		// Получаем уникальные брейкпоинты
		let mediaQueries = breakpointsArray.map(function (item) {
			return '(' + item.type + "-width: " + item.value + "px)," + item.value + ',' + item.type;
		});
		mediaQueries = mediaQueries.filter(function (item, index, self) {
			return self.indexOf(item) === index;
		});

		// Работаем с каждым брейкпоинтом
		mediaQueries.forEach(breakpoint => {
			const paramsArray = breakpoint.split(",");
			const mediaBreakpoint = paramsArray[1];
			const mediaType = paramsArray[2];
			const matchMedia = window.matchMedia(paramsArray[0]);

			// Объекты с нужными условиями
			const spollersArray = breakpointsArray.filter(function (item) {
				if (item.value === mediaBreakpoint && item.type === mediaType) {
					return true;
				}
			});
			// Событие
			matchMedia.addListener(function () {
				initSpollers(spollersArray, matchMedia);
			});
			initSpollers(spollersArray, matchMedia);
		});
	}
	// Инициализация
	function initSpollers(spollersArray, matchMedia = false) {
		spollersArray.forEach(spollersBlock => {
			spollersBlock = matchMedia ? spollersBlock.item : spollersBlock;
			if (matchMedia.matches || !matchMedia) {
				spollersBlock.classList.add('_init');
				initSpollerBody(spollersBlock);
				spollersBlock.addEventListener("click", setSpollerAction);
			} else {
				spollersBlock.classList.remove('_init');
				initSpollerBody(spollersBlock, false);
				spollersBlock.removeEventListener("click", setSpollerAction);
			}
		});
	}
	// Работа с контентом
	function initSpollerBody(spollersBlock, hideSpollerBody = true) {
		const spollerTitles = spollersBlock.querySelectorAll('[data-spoller]');
		if (spollerTitles.length > 0) {
			spollerTitles.forEach(spollerTitle => {
				if (hideSpollerBody) {
					spollerTitle.removeAttribute('tabindex');
					if (!spollerTitle.classList.contains('_active')) {
						spollerTitle.nextElementSibling.hidden = true;
					}
				} else {
					spollerTitle.setAttribute('tabindex', '-1');
					spollerTitle.nextElementSibling.hidden = false;
				}
			});
		}
	}

	function setSpollerAction(e) {
		const el = e.target;
		if (el.hasAttribute('data-spoller') || el.closest('[data-spoller]')) {
			const spollerTitle = el.hasAttribute('data-spoller') ? el : el.closest('[data-spoller]');
			const spollersBlock = spollerTitle.closest('[data-spollers]');
			const oneSpoller = spollersBlock.hasAttribute('data-one-spoller') ? true : false;
			if (!spollersBlock.querySelectorAll('._slide').length) {
				if (oneSpoller && !spollerTitle.classList.contains('_active')) {
					hideSpollersBody(spollersBlock);
				}
				spollerTitle.classList.toggle('_active');
				_slideToggle(spollerTitle.nextElementSibling, 500);
			}
			e.preventDefault();
		}
	}

	function hideSpollersBody(spollersBlock) {
		const spollerActiveTitle = spollersBlock.querySelector('[data-spoller]._active');
		if (spollerActiveTitle) {
			spollerActiveTitle.classList.remove('_active');
			_slideUp(spollerActiveTitle.nextElementSibling, 500);
		}
	}
}

//=================
//Popups
let popup_link = document.querySelectorAll('._popup-link');
let popups = document.querySelectorAll('.popup');
for (let index = 0; index < popup_link.length; index++) {
	const el = popup_link[index];
	el.addEventListener('click', function (e) {
		if (unlock) {
			let item = el.getAttribute('href').replace('#', '');
			let video = el.getAttribute('data-video');
			popup_open(item, video);
		}
		e.preventDefault();
	})
}
for (let index = 0; index < popups.length; index++) {
	const popup = popups[index];
	popup.addEventListener("click", function (e) {
		if (!e.target.closest('.popup__body')) {
			popup_close(e.target.closest('.popup'));
		}
	});
}

function popup_open(item, video = '') {
	let activePopup = document.querySelectorAll('.popup._active');
	if (activePopup.length > 0) {
		popup_close('', false);
	}
	let curent_popup = document.querySelector('.popup_' + item);
	if (curent_popup && unlock) {
		if (video != '' && video != null) {
			let popup_video = document.querySelector('.popup_video');
			popup_video.querySelector('.popup__video').innerHTML = '<iframe src="https://www.youtube.com/embed/' + video + '?autoplay=1"  allow="autoplay; encrypted-media" allowfullscreen></iframe>';
		}
		if (!document.querySelector('.menu__body._active')) {
			body_lock_add(500);
		}
		curent_popup.classList.add('_active');
		history.pushState('', '', '#' + item);
	}
}

function popup_close(item, bodyUnlock = true) {
	if (unlock) {
		if (!item) {
			for (let index = 0; index < popups.length; index++) {
				const popup = popups[index];
				let video = popup.querySelector('.popup__video');
				if (video) {
					video.innerHTML = '';
				}
				popup.classList.remove('_active');
			}
		} else {
			let video = item.querySelector('.popup__video');
			if (video) {
				video.innerHTML = '';
			}
			item.classList.remove('_active');
		}
		if (!document.querySelector('.menu__body._active') && bodyUnlock) {
			body_lock_remove(500);
		}
		history.pushState('', '', window.location.href.split('#')[0]);
	}
}
let popup_close_icon = document.querySelectorAll('.popup__close,._popup-close');
if (popup_close_icon) {
	for (let index = 0; index < popup_close_icon.length; index++) {
		const el = popup_close_icon[index];
		el.addEventListener('click', function () {
			popup_close(el.closest('.popup'));
		})
	}
}
document.addEventListener('keydown', function (e) {
	if (e.code === 'Escape') {
		popup_close();
	}
});

//=================
//SlideToggle
let _slideUp = (target, duration = 500) => {
	if (!target.classList.contains('_slide')) {
		target.classList.add('_slide');
		target.style.transitionProperty = 'height, margin, padding';
		target.style.transitionDuration = duration + 'ms';
		target.style.height = target.offsetHeight + 'px';
		target.offsetHeight;
		target.style.overflow = 'hidden';
		target.style.height = 0;
		target.style.paddingTop = 0;
		target.style.paddingBottom = 0;
		target.style.marginTop = 0;
		target.style.marginBottom = 0;
		window.setTimeout(() => {
			target.hidden = true;
			target.style.removeProperty('height');
			target.style.removeProperty('padding-top');
			target.style.removeProperty('padding-bottom');
			target.style.removeProperty('margin-top');
			target.style.removeProperty('margin-bottom');
			target.style.removeProperty('overflow');
			target.style.removeProperty('transition-duration');
			target.style.removeProperty('transition-property');
			target.classList.remove('_slide');
		}, duration);
	}
}
let _slideDown = (target, duration = 500) => {
	if (!target.classList.contains('_slide')) {
		target.classList.add('_slide');
		if (target.hidden) {
			target.hidden = false;
		}
		let height = target.offsetHeight;
		target.style.overflow = 'hidden';
		target.style.height = 0;
		target.style.paddingTop = 0;
		target.style.paddingBottom = 0;
		target.style.marginTop = 0;
		target.style.marginBottom = 0;
		target.offsetHeight;
		target.style.transitionProperty = "height, margin, padding";
		target.style.transitionDuration = duration + 'ms';
		target.style.height = height + 'px';
		target.style.removeProperty('padding-top');
		target.style.removeProperty('padding-bottom');
		target.style.removeProperty('margin-top');
		target.style.removeProperty('margin-bottom');
		window.setTimeout(() => {
			target.style.removeProperty('height');
			target.style.removeProperty('overflow');
			target.style.removeProperty('transition-duration');
			target.style.removeProperty('transition-property');
			target.classList.remove('_slide');
		}, duration);
	}
}
let _slideToggle = (target, duration = 500) => {
	if (target.hidden) {
		return _slideDown(target, duration);
	} else {
		return _slideUp(target, duration);
	}
}

// ShowMore Beta ========================
let moreBlocks = document.querySelectorAll('._more-block');
if (moreBlocks.length > 0) {
	let wrapper = document.querySelector('.wrapper');
	for (let index = 0; index < moreBlocks.length; index++) {
		const moreBlock = moreBlocks[index];
		let items = moreBlock.querySelectorAll('._more-item');
		if (items.length > 0 && window.innerWidth < 768) {
			moreBlock.classList.add('_init');
			let itemsMore = moreBlock.querySelector('._more-link');
			let itemsContent = moreBlock.querySelector('._more-content');
			let itemsView = itemsContent.getAttribute('data-view');
			if (getComputedStyle(itemsContent).getPropertyValue("transition-duration") === '0s') {
				itemsContent.style.cssText = "transition-duration: 1ms";
			}
			itemsMore.addEventListener("click", function (e) {
				if (itemsMore.classList.contains('_active')) {
					setSize();
				} else {
					setSize('start');
				}
				itemsMore.classList.toggle('_active');
				e.preventDefault();
			});

			let isScrollStart;

			function setSize(type) {
				let resultHeight;
				let itemsContentHeight = 0;
				let itemsContentStartHeight = 0;

				for (let index = 0; index < items.length; index++) {
					if (index < itemsView) {
						itemsContentHeight += items[index].offsetHeight;
					}
					itemsContentStartHeight += items[index].offsetHeight;
				}
				resultHeight = (type === 'start') ? itemsContentStartHeight : itemsContentHeight;
				isScrollStart = window.innerWidth - wrapper.offsetWidth;
				itemsContent.style.height = `${resultHeight}px`;
			}

			itemsContent.addEventListener("transitionend", updateSize, false);

			function updateSize() {
				let isScrollEnd = window.innerWidth - wrapper.offsetWidth;
				if (isScrollStart === 0 && isScrollEnd > 0 || isScrollStart > 0 && isScrollEnd === 0) {
					if (itemsMore.classList.contains('_active')) {
						setSize('start');
					} else {
						setSize();
					}
				}
			}
			window.addEventListener("resize", function (e) {
				if (!itemsMore.classList.contains('_active')) {
					setSize();
				} else {
					setSize('start');
				}
			});
			setSize();
		}
	}
}
const sliderImage = new Swiper('.slider-img', {
   // Optional parameters
   loop: true,
   observer: true,
   observeParents: true,

   // Navigation arrows
   navigation: {
      nextEl: '.slider-img__btn-next',
      prevEl: '.slider-img__btn-prev',
   },

   breakpoints: {
      320: {
         slidesPerView: 1,
         spaceBetween: 30
      },
   },

});

const sliderAbout = new Swiper('.slider-about', {
   // Optional parameters

   // Navigation arrows
   navigation: {
      nextEl: '.slider-about__btn-next',
      prevEl: '.slider-about__btn-prev',
   },

   breakpoints: {
      200: {
         slidesPerView: 2,
         spaceBetween: 8
      },

      480: {
         slidesPerView: 2,
         spaceBetween: 50
      },

      570: {
         slidesPerView: 3,
         spaceBetween: 15
      },

      1290: {
         slidesPerView: 3,
         spaceBetween: 30
      }
   },

   pagination: {
      el: '.slider-about__pagination',
      type: 'fraction',
      formatFractionCurrent: function (number) {
         return ('0' + number).slice(-2);
      },
      formatFractionTotal: function (number) {
         return ('0' + number).slice(-2);
      },
      renderFraction: function (currentClass, totalClass) {
         return '<span class="' + currentClass + '"></span>' +
            ' / ' +
            '<span class="' + totalClass + '"></span>';
      }
   },

});

const sliderClients = new Swiper('.clients-slider', {
   // Optional parameters

   // Navigation arrows
   navigation: {
      nextEl: '#clients-slider-btn-next',
      prevEl: '#clients-slider-btn-prev',
   },

   breakpoints: {
      200: {
         slidesPerView: 2,
         spaceBetween: 15
      },
      340: {
         slidesPerView: 2,
         spaceBetween: 20
      },
      500: {
         slidesPerView: 3,
         spaceBetween: 20
      },
      768: {
         slidesPerView: 4,
         spaceBetween: 20
      },
      1100: {
         slidesPerView: 6,
         spaceBetween: 30
      },
   },

   pagination: {
      el: '#clients-slider-pagination',
      type: 'fraction',
      formatFractionCurrent: function (number) {
         return ('0' + number).slice(-2);
      },
      formatFractionTotal: function (number) {
         return ('0' + number).slice(-2);
      },
      renderFraction: function (currentClass, totalClass) {
         return '<span class="' + currentClass + '"></span>' +
            ' / ' +
            '<span class="' + totalClass + '"></span>';
      }
   },

});

const specialistsSlider = new Swiper('.specialists-slider', {
   // Optional parameters

   // Navigation arrows
   navigation: {
      nextEl: '#specialists-slider-btn-next',
      prevEl: '#specialists-slider-btn-prev',
   },

   breakpoints: {
      200: {
         slidesPerView: 2,
         spaceBetween: 10
      },
      480: {
         slidesPerView: 2,
         spaceBetween: 20
      },
      580: {
         slidesPerView: 3,
         spaceBetween: 20
      },
      768: {
         slidesPerView: 4,
         spaceBetween: 20
      },
      1024: {
         slidesPerView: 5,
         spaceBetween: 25
      },
   },

   pagination: {
      el: '#specialists-slider-pagination',
      type: 'fraction',
      formatFractionCurrent: function (number) {
         return ('0' + number).slice(-2);
      },
      formatFractionTotal: function (number) {
         return ('0' + number).slice(-2);
      },
      renderFraction: function (currentClass, totalClass) {
         return '<span class="' + currentClass + '"></span>' +
            ' / ' +
            '<span class="' + totalClass + '"></span>';
      }
   },

});

const singleSlider = new Swiper('.single-slider', {
   // Optional parameters

   observer: true,
   observeParents: true,

   breakpoints: {
      320: {
         slidesPerView: 1,
         spaceBetween: 20
      },
      768: {
         slidesPerView: 1,
         spaceBetween: 30
      },
      1310: {
         slidesPerView: 'auto',
         spaceBetween: 30
      },
   },

   // Navigation arrows
   navigation: {
      nextEl: '#single-slider-btn-next',
      prevEl: '#single-slider-btn-prev',
   },

   pagination: {
      el: '#single-slider-pagination',
      type: 'fraction',
      formatFractionCurrent: function (number) {
         return ('0' + number).slice(-2);
      },
      formatFractionTotal: function (number) {
         return ('0' + number).slice(-2);
      },
      renderFraction: function (currentClass, totalClass) {
         return '<span class="' + currentClass + '"></span>' +
            ' / ' +
            '<span class="' + totalClass + '"></span>';
      }
   },

});


const tabsSlider = new Swiper('.tabs-slider', {
   // Optional parameters

   observer: true,
   observeParents: true,
   freeMode: true,

   breakpoints: {
      200: {
         slidesPerView: 'auto',
      },
   },

   // Navigation arrows
   navigation: {
      nextEl: '#tabs-slider-btn-next',
      prevEl: '#tabs-slider-btn-prev',
   },

   pagination: {
      el: '#tabs-slider-pagination',
      type: 'fraction',
      formatFractionCurrent: function (number) {
         return ('0' + number).slice(-2);
      },
      formatFractionTotal: function (number) {
         return ('0' + number).slice(-2);
      },
      renderFraction: function (currentClass, totalClass) {
         return '<span class="' + currentClass + '"></span>' +
            ' / ' +
            '<span class="' + totalClass + '"></span>';
      }
   },

});

const documentsSlider = new Swiper('.documents-slider', {
   // Optional parameters

   observer: true,
   observeParents: true,

   breakpoints: {
      200: {
         slidesPerView: 2,
         spaceBetween: 15,
      },
      768: {
         slidesPerView: 4,
         spaceBetween: 20,
      },
      1024: {
         slidesPerView: 4,
         spaceBetween: 30,
      },
   },

   // Navigation arrows
   navigation: {
      nextEl: '#documents-slider-btn-next',
      prevEl: '#documents-slider-btn-prev',
   },

   pagination: {
      el: '#documents-slider-pagination',
      type: 'fraction',
      formatFractionCurrent: function (number) {
         return ('0' + number).slice(-2);
      },
      formatFractionTotal: function (number) {
         return ('0' + number).slice(-2);
      },
      renderFraction: function (currentClass, totalClass) {
         return '<span class="' + currentClass + '"></span>' +
            ' / ' +
            '<span class="' + totalClass + '"></span>';
      }
   },

});

const servicesReqSlider = new Swiper('.services-req-slider', {
   observer: true,
   observeParents: true,
   speed: 500,
   watchOverflow: true,
   breakpoints: {
      320: {
         slidesPerView: 1,
         spaceBetween: 10,
      },
      700: {
         slidesPerView: 2,
         spaceBetween: 20,
      },

      1024: {
         slidesPerView: 3,
         spaceBetween: 20,
      },

      1270: {
         slidesPerView: 3,
         spaceBetween: 30,
      },
   },

   // Arrows
   navigation: {
      nextEl: '#services-req-slider-btn-next',
      prevEl: '#services-req-slider-btn-prev',
   },

   pagination: {
      el: '#services-req-slider-pagination',
      type: 'fraction',
      formatFractionCurrent: function (number) {
         return ('0' + number).slice(-2);
      },
      formatFractionTotal: function (number) {
         return ('0' + number).slice(-2);
      },
      renderFraction: function (currentClass, totalClass) {
         return '<span class="' + currentClass + '"></span>' +
            ' / ' +
            '<span class="' + totalClass + '"></span>';
      }
   },

});

const photoTabs = new Swiper('.photo-tabs-slider', {
   speed: 500,
   watchOverflow: true,
   breakpoints: {
      200: {
         slidesPerView: 5,
         spaceBetween: 10,
      },
      480: {
         slidesPerView: 6,
         spaceBetween: 10,
      },
      768: {
         slidesPerView: 5,
         spaceBetween: 10,
      },
      1024: {
         slidesPerView: 7,
         spaceBetween: 10,
      },
      1290: {
         slidesPerView: 7,
         spaceBetween: 20,
      },
   },
});



let servicesSlider = undefined;
const servicesSliderLink = document.querySelector('.services-slider');

if (servicesSliderLink) {
   if (window.innerWidth <= 1270) {
      initSlider();
   }

   window.addEventListener('resize', () => {
      let windowWidth = window.innerWidth;

      if (windowWidth <= 1270 && servicesSlider == undefined) {

         initSlider();

      } else if (windowWidth > 1270 && servicesSlider != undefined) {

         servicesSlider.destroy();
         servicesSlider = undefined;

      }

   })
}

function initSlider() {
   servicesSlider = new Swiper('.services-slider', {
      observer: true,
      observeParents: true,
      slidesPerView: 2,
      speed: 500,
      watchOverflow: true,
      spaceBetween: 20,
      breakpoints: {
         320: {
            slidesPerView: 2,
            spaceBetween: 15,
         },
         480: {
            slidesPerView: 2,
            spaceBetween: 20,
         },

         768: {
            slidesPerView: 3,
            spaceBetween: 20,
         },

         1024: {
            slidesPerView: 4,
            spaceBetween: 20,
         },

         1270: {
            slidesPerView: "auto",
            allowTouchMove: true,
         },
      },

      // Arrows
      navigation: {
         nextEl: '#services-slider-btn-next',
         prevEl: '#services-slider-btn-prev',
      },

      pagination: {
         el: '#services-slider-pagination',
         type: 'fraction',
         formatFractionCurrent: function (number) {
            return ('0' + number).slice(-2);
         },
         formatFractionTotal: function (number) {
            return ('0' + number).slice(-2);
         },
         renderFraction: function (currentClass, totalClass) {
            return '<span class="' + currentClass + '"></span>' +
               ' / ' +
               '<span class="' + totalClass + '"></span>';
         }
      },

   });
}

const slider_block = new Swiper('.photo-swipe__slider', {
   spaceBetween: 10,
   slidesPerView: 1,
});

const slider_nav_items = document.querySelectorAll('.photo-tabs-slider__tab');
if(slider_nav_items) {
   slider_nav_items.forEach((el, index) => {
      el.setAttribute('data-index', index);
      el.addEventListener('click', (e) => {
         if (e.target.dataset.index) {
            const index = parseInt(e.target.dataset.index);
         } else {
            const index = parseInt(e.target.closest('.photo-tabs-slider__tab').dataset.index);
         }
         slider_block.slideTo(index);
      })
   })
}

let $body = document.body;
let $window = window;
let $header = $body.querySelector('header.header');

$body.addEventListener('click', documentActions);

function documentActions(e) {
   const targetElement = e.target;

   const searchIconMob = targetElement.closest('.search-header__icon-mob');
   // Поиск в меню
   if (searchIconMob) {
      searchIconMob.classList.toggle('_active');
   } else if (!targetElement.closest('.search-header')) {
      const searchIcons = document.querySelectorAll('.search-header__icon-mob');
      removeClass(searchIcons, '_active');
   }

   //  Главное меню
   const mainNav = $body.querySelector("header .nav");
   const iconMenu = $header.querySelector(".icon-menu");
   const activeMunuItems = mainNav.querySelectorAll('._active');

   // Удаляем все классы ._active у меню если меню открыто
   if ($body.querySelector('.nav__list._active')) {

      // если клик по icon-menu
      if (targetElement.classList.contains('icon-menu') || targetElement.closest('.icon-menu')) {
         // Удаляем у icon-menu
         iconMenu.classList.remove('_active');
         removeClass(activeMunuItems, '_active');
         return;
         // если клик не по меню
      }
      if (!targetElement.closest('.nav')) {
         // Удаляем у icon-menu
         iconMenu.classList.remove('_active');
         removeClass(activeMunuItems, '_active');
         return;
      }
   }

   if (targetElement.closest('header')) {
      const navList = mainNav.querySelector(".nav__list");
      // Добавляем класс ._active если клик по icon-menu
      if (targetElement.classList.contains('icon-menu') || targetElement.closest('.icon-menu')) {
         iconMenu.classList.add("_active");
         navList.classList.add("_active");
         return;
      }
      if (targetElement.classList.contains('nav__down') || targetElement.closest('.nav__down')) {
         const parentList = targetElement.closest('.nav__sub-item, .nav__item');
         parentList.classList.remove('_active');
      }
   }

   // tabs-faq добавляем блоку актив
   if (targetElement.closest('.tabs-faq__block-title') || targetElement.classList.contains('tabs-faq__block-title')) {
      const faqBlock = targetElement.closest('.tabs-faq__block');
      if (!targetElement.closest('.tabs-faq__block._hover')) {
         const faqBlockActive = document.querySelectorAll('.tabs-faq__block._hover');
         removeClass(faqBlockActive, ("_hover"));
      }
      faqBlock.classList.toggle('_hover');
   }
}

const menuLinks = $body.querySelectorAll('.nav__link');
if (menuLinks) {
   menuLinks.forEach(menuLink => {
      const menuItem = menuLink.closest('.nav__sub-list, .nav__list');
      const currentMenuAttr = menuItem.getAttribute('menu-lvl');
      menuLink.addEventListener('click', function (e) {
         const targetLink = e.target;
         const parentItem = targetLink.closest('.nav__sub-item, .nav__item');
         if (parentItem && parentItem.querySelector('.nav__sub-list')) {
            e.preventDefault();
            parentItem.classList.toggle('_active');
         }

         const menuListsActive = document.querySelectorAll(`[menu-lvl='${currentMenuAttr}'] > ._active`);

         if (menuListsActive && menuListsActive.length >= 2) {
            for (let i = 0; i < menuListsActive.length; i++) {
               const element = menuListsActive[i];
               if (element != parentItem) {
                  const childrenActive = element.querySelectorAll('._active');
                  childrenActive.forEach(children => children.classList.remove('_active'));
                  element.classList.remove('_active');
               }
            }
         }

      })
   })
}

function removeClass(array, selector) {
   if (array) {
      array.forEach(arrayItem => {
         arrayItem.classList.remove(selector);
      })
   }
}
// 
function mapAdd() {
	let tag = document.createElement('script');
	tag.src = "https://maps.google.com/maps/api/js?sensor=false&amp;key=&callback=mapInit";
	let firstScriptTag = document.getElementsByTagName('script')[0];
	firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
}
function mapInit(n = 1) {
	google.maps.Map.prototype.setCenterWithOffset = function (latlng, offsetX, offsetY) {
		var map = this;
		var ov = new google.maps.OverlayView();
		ov.onAdd = function () {
			var proj = this.getProjection();
			var aPoint = proj.fromLatLngToContainerPixel(latlng);
			aPoint.x = aPoint.x + offsetX;
			aPoint.y = aPoint.y + offsetY;
			map.panTo(proj.fromContainerPixelToLatLng(aPoint));
			//map.setCenter(proj.fromContainerPixelToLatLng(aPoint));
		}
		ov.draw = function () { };
		ov.setMap(this);
	};
	var markers = new Array();
	var infowindow = new google.maps.InfoWindow({
		//pixelOffset: new google.maps.Size(-230,250)
	});
	var locations = [
		[new google.maps.LatLng(53.819055, 27.8813694)],
		[new google.maps.LatLng(53.700055, 27.5513694)],
		[new google.maps.LatLng(53.809055, 27.5813694)],
		[new google.maps.LatLng(53.859055, 27.5013694)],
	]
	var options = {
		zoom: 10,
		panControl: false,
		mapTypeControl: false,
		center: locations[0][0],
		styles: [{ "featureType": "landscape.natural", "elementType": "geometry.fill", "stylers": [{ "visibility": "on" }, { "color": "#e0efef" }] }, { "featureType": "poi", "elementType": "geometry.fill", "stylers": [{ "visibility": "on" }, { "hue": "#1900ff" }, { "color": "#c0e8e8" }] }, { "featureType": "road", "elementType": "geometry", "stylers": [{ "lightness": 100 }, { "visibility": "simplified" }] }, { "featureType": "road", "elementType": "labels", "stylers": [{ "visibility": "off" }] }, { "featureType": "transit.line", "elementType": "geometry", "stylers": [{ "visibility": "on" }, { "lightness": 700 }] }, { "featureType": "water", "elementType": "all", "stylers": [{ "color": "#7dcdcd" }] }],
		scrollwheel: false,
		mapTypeId: google.maps.MapTypeId.ROADMAP
	};
	var map = new google.maps.Map(document.getElementById('map'), options);
	var icon = {
		url: 'img/icons/map.svg',
		scaledSize: new google.maps.Size(18, 20),
		anchor: new google.maps.Point(9, 10)
	}
	for (var i = 0; i < locations.length; i++) {
		var marker = new google.maps.Marker({
			icon: icon,
			position: locations[i][0],
			map: map,
		});
		google.maps.event.addListener(marker, 'click', (function (marker, i) {
			return function () {
				for (var m = 0; m < markers.length; m++) {
					markers[m].setIcon(icon);
				}
				var cnt = i + 1;
				//infowindow.setContent(document.querySelector('.events-map__item_' + cnt).innerHTML);
				//infowindow.open(map, marker);
				marker.setIcon(icon);
				map.setCenterWithOffset(marker.getPosition(), 0, 0);
				setTimeout(function () {

				}, 10);
			}
		})(marker, i));
		markers.push(marker);
	}
	if (n) {
		var nc = n - 1;
		setTimeout(function () {
			google.maps.event.trigger(markers[nc], 'click');
		}, 500);
	}
}
if (document.querySelector('#map')) {
	mapAdd();
}


/* YA
function map(n) {
	ymaps.ready(init);
	function init() {
		// Создание карты.
		var myMap = new ymaps.Map("map", {
			// Координаты центра карты.
			// Порядок по умолчанию: «широта, долгота».
			// Чтобы не определять координаты центра карты вручную,
			// воспользуйтесь инструментом Определение координат.
			controls: [],
			center: [43.585525, 39.723062],
			// Уровень масштабирования. Допустимые значения:
			// от 0 (весь мир) до 19.
			zoom: 10
		});

		let myPlacemark = new ymaps.Placemark([43.585525, 39.723062], {
		},{
			// Опции.
			//balloonContentHeader: 'Mistoun',
			//balloonContentBody: 'Москва, Николоямская 40с1',
			//balloonContentFooter: '+ 7(495) 507-54 - 90',
			//hasBalloon: true,
			//hideIconOnBalloonOpen: true,

			hasBalloon: false,
			hideIconOnBalloonOpen: false,
			// Необходимо указать данный тип макета.
			iconLayout: 'default#imageWithContent',
			// Своё изображение иконки метки.
			iconImageHref: 'img/icons/map.svg',
			// Размеры метки.
			iconImageSize: [40, 40],
			// Смещение левого верхнего угла иконки относительно
			// её "ножки" (точки привязки).
			iconImageOffset: [-20, -20],
			// Смещение слоя с содержимым относительно слоя с картинкой.
			iconContentOffset: [0, 0],
		});
		myMap.geoObjects.add(myPlacemark);

		myMap.behaviors.disable('scrollZoom');
		myMap.behaviors.disable('drag');
	}
}
*/