let ua = window.navigator.userAgent;
let msie = ua.indexOf("MSIE ");
let isMobile = { Android: function () { return navigator.userAgent.match(/Android/i); }, BlackBerry: function () { return navigator.userAgent.match(/BlackBerry/i); }, iOS: function () { return navigator.userAgent.match(/iPhone|iPad|iPod/i); }, Opera: function () { return navigator.userAgent.match(/Opera Mini/i); }, Windows: function () { return navigator.userAgent.match(/IEMobile/i); }, any: function () { return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows()); } };
function isIE() {
	ua = navigator.userAgent;
	var is_ie = ua.indexOf("MSIE ") > -1 || ua.indexOf("Trident/") > -1;
	return is_ie;
}
if (isIE()) {
	document.querySelector('html').classList.add('ie');
}
if (isMobile.any()) {
	document.querySelector('html').classList.add('_touch');
}

// Получить цифры из строки
//parseInt(itemContactpagePhone.replace(/[^\d]/g, ''))

function testWebP(callback) {
	var webP = new Image();
	webP.onload = webP.onerror = function () {
		callback(webP.height == 2);
	};
	webP.src = "data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";
}
testWebP(function (support) {
	if (support === true) {
		document.querySelector('html').classList.add('_webp');
	} else {
		document.querySelector('html').classList.add('_no-webp');
	}
});

function ibg() {
	if (isIE()) {
		let ibg = document.querySelectorAll("._ibg");
		for (var i = 0; i < ibg.length; i++) {
			if (ibg[i].querySelector('img') && ibg[i].querySelector('img').getAttribute('src') != null) {
				ibg[i].style.backgroundImage = 'url(' + ibg[i].querySelector('img').getAttribute('src') + ')';
			}
		}
	}
}
ibg();

window.addEventListener("load", function () {
	if (document.querySelector('.wrapper')) {
		setTimeout(function () {
			document.querySelector('.wrapper').classList.add('_loaded');
		}, 0);
	}
});

let unlock = true;

//=================
//Menu
// let iconMenu = document.querySelector(".icon-menu");
// if (iconMenu != null) {
// 	let delay = 500;
// 	let menuBody = document.querySelector(".header__nav");
// 	iconMenu.addEventListener("click", function (e) {
// 		if (unlock) {
// 			body_lock(delay);
// 			iconMenu.classList.toggle("_active");
// 			menuBody.classList.toggle("_active");
// 		}
// 	});
// };
function menu_close() {
	let iconMenu = document.querySelector(".icon-menu");
	let menuBody = document.querySelector(".header__nav");
	iconMenu.classList.remove("_active");
	menuBody.classList.remove("_active");
}
//=================
//BodyLock
function body_lock(delay) {
	let body = document.querySelector("body");
	if (body.classList.contains('_lock')) {
		body_lock_remove(delay);
	} else {
		body_lock_add(delay);
	}
}
function body_lock_remove(delay) {
	let body = document.querySelector("body");
	if (unlock) {
		let lock_padding = document.querySelectorAll("._lp");
		setTimeout(() => {
			for (let index = 0; index < lock_padding.length; index++) {
				const el = lock_padding[index];
				el.style.paddingRight = '0px';
			}
			body.style.paddingRight = '0px';
			body.classList.remove("_lock");
		}, delay);

		unlock = false;
		setTimeout(function () {
			unlock = true;
		}, delay);
	}
}
function body_lock_add(delay) {
	let body = document.querySelector("body");
	if (unlock) {
		let lock_padding = document.querySelectorAll("._lp");
		for (let index = 0; index < lock_padding.length; index++) {
			const el = lock_padding[index];
			el.style.paddingRight = window.innerWidth - document.querySelector('.wrapper').offsetWidth + 'px';
		}
		body.style.paddingRight = window.innerWidth - document.querySelector('.wrapper').offsetWidth + 'px';
		body.classList.add("_lock");

		unlock = false;
		setTimeout(function () {
			unlock = true;
		}, delay);
	}
}
//=================
//Tabs
let tabs = document.querySelectorAll("._tabs");
for (let index = 0; index < tabs.length; index++) {
	let tab = tabs[index];
	let tabs_items = tab.querySelectorAll("._tabs-item");
	let tabs_blocks = tab.querySelectorAll("._tabs-block");
	for (let index = 0; index < tabs_items.length; index++) {
		let tabs_item = tabs_items[index];
		tabs_item.addEventListener("click", function (e) {
			for (let index = 0; index < tabs_items.length; index++) {
				let tabs_item = tabs_items[index];
				tabs_item.classList.remove('_active');
				tabs_blocks[index].classList.remove('_active');
			}
			tabs_item.classList.add('_active');
			tabs_blocks[index].classList.add('_active');
			e.preventDefault();
		});
	}
}
//=================
/*
Для родителя слойлеров пишем атрибут data-spollers
Для заголовков слойлеров пишем атрибут data-spoller
Если нужно включать\выключать работу спойлеров на разных размерах экранов
пишем параметры ширины и типа брейкпоинта.
Например: 
data-spollers="992,max" - спойлеры будут работать только на экранах меньше или равно 992px
data-spollers="768,min" - спойлеры будут работать только на экранах больше или равно 768px

Если нужно что бы в блоке открывался болько один слойлер добавляем атрибут data-one-spoller
*/

// SPOLLERS
const spollersArray = document.querySelectorAll('[data-spollers]');
if (spollersArray.length > 0) {
	// Получение обычных слойлеров
	const spollersRegular = Array.from(spollersArray).filter(function (item, index, self) {
		return !item.dataset.spollers.split(",")[0];
	});
	// Инициализация обычных слойлеров
	if (spollersRegular.length > 0) {
		initSpollers(spollersRegular);
	}

	// Получение слойлеров с медиа запросами
	const spollersMedia = Array.from(spollersArray).filter(function (item, index, self) {
		return item.dataset.spollers.split(",")[0];
	});

	// Инициализация слойлеров с медиа запросами
	if (spollersMedia.length > 0) {
		const breakpointsArray = [];
		spollersMedia.forEach(item => {
			const params = item.dataset.spollers;
			const breakpoint = {};
			const paramsArray = params.split(",");
			breakpoint.value = paramsArray[0];
			breakpoint.type = paramsArray[1] ? paramsArray[1].trim() : "max";
			breakpoint.item = item;
			breakpointsArray.push(breakpoint);
		});

		// Получаем уникальные брейкпоинты
		let mediaQueries = breakpointsArray.map(function (item) {
			return '(' + item.type + "-width: " + item.value + "px)," + item.value + ',' + item.type;
		});
		mediaQueries = mediaQueries.filter(function (item, index, self) {
			return self.indexOf(item) === index;
		});

		// Работаем с каждым брейкпоинтом
		mediaQueries.forEach(breakpoint => {
			const paramsArray = breakpoint.split(",");
			const mediaBreakpoint = paramsArray[1];
			const mediaType = paramsArray[2];
			const matchMedia = window.matchMedia(paramsArray[0]);

			// Объекты с нужными условиями
			const spollersArray = breakpointsArray.filter(function (item) {
				if (item.value === mediaBreakpoint && item.type === mediaType) {
					return true;
				}
			});
			// Событие
			matchMedia.addListener(function () {
				initSpollers(spollersArray, matchMedia);
			});
			initSpollers(spollersArray, matchMedia);
		});
	}
	// Инициализация
	function initSpollers(spollersArray, matchMedia = false) {
		spollersArray.forEach(spollersBlock => {
			spollersBlock = matchMedia ? spollersBlock.item : spollersBlock;
			if (matchMedia.matches || !matchMedia) {
				spollersBlock.classList.add('_init');
				initSpollerBody(spollersBlock);
				spollersBlock.addEventListener("click", setSpollerAction);
			} else {
				spollersBlock.classList.remove('_init');
				initSpollerBody(spollersBlock, false);
				spollersBlock.removeEventListener("click", setSpollerAction);
			}
		});
	}
	// Работа с контентом
	function initSpollerBody(spollersBlock, hideSpollerBody = true) {
		const spollerTitles = spollersBlock.querySelectorAll('[data-spoller]');
		if (spollerTitles.length > 0) {
			spollerTitles.forEach(spollerTitle => {
				if (hideSpollerBody) {
					spollerTitle.removeAttribute('tabindex');
					if (!spollerTitle.classList.contains('_active')) {
						spollerTitle.nextElementSibling.hidden = true;
					}
				} else {
					spollerTitle.setAttribute('tabindex', '-1');
					spollerTitle.nextElementSibling.hidden = false;
				}
			});
		}
	}
	function setSpollerAction(e) {
		const el = e.target;
		if (el.hasAttribute('data-spoller') || el.closest('[data-spoller]')) {
			const spollerTitle = el.hasAttribute('data-spoller') ? el : el.closest('[data-spoller]');
			const spollersBlock = spollerTitle.closest('[data-spollers]');
			const oneSpoller = spollersBlock.hasAttribute('data-one-spoller') ? true : false;
			if (!spollersBlock.querySelectorAll('._slide').length) {
				if (oneSpoller && !spollerTitle.classList.contains('_active')) {
					hideSpollersBody(spollersBlock);
				}
				spollerTitle.classList.toggle('_active');
				_slideToggle(spollerTitle.nextElementSibling, 500);
			}
			e.preventDefault();
		}
	}
	function hideSpollersBody(spollersBlock) {
		const spollerActiveTitle = spollersBlock.querySelector('[data-spoller]._active');
		if (spollerActiveTitle) {
			spollerActiveTitle.classList.remove('_active');
			_slideUp(spollerActiveTitle.nextElementSibling, 500);
		}
	}
}
//=================
//Popups
let popup_link = document.querySelectorAll('._popup-link');
let popups = document.querySelectorAll('.popup');
for (let index = 0; index < popup_link.length; index++) {
	const el = popup_link[index];
	el.addEventListener('click', function (e) {
		if (unlock) {
			let item = el.getAttribute('href').replace('#', '');
			let video = el.getAttribute('data-video');
			popup_open(item, video);
		}
		e.preventDefault();
	})
}
for (let index = 0; index < popups.length; index++) {
	const popup = popups[index];
	popup.addEventListener("click", function (e) {
		if (!e.target.closest('.popup__body')) {
			popup_close(e.target.closest('.popup'));
		}
	});
}
function popup_open(item, video = '') {
	let activePopup = document.querySelectorAll('.popup._active');
	if (activePopup.length > 0) {
		popup_close('', false);
	}
	let curent_popup = document.querySelector('.popup_' + item);
	if (curent_popup && unlock) {
		if (video != '' && video != null) {
			let popup_video = document.querySelector('.popup_video');
			popup_video.querySelector('.popup__video').innerHTML = '<iframe src="https://www.youtube.com/embed/' + video + '?autoplay=1"  allow="autoplay; encrypted-media" allowfullscreen></iframe>';
		}
		if (!document.querySelector('.menu__body._active')) {
			body_lock_add(500);
		}
		curent_popup.classList.add('_active');
		history.pushState('', '', '#' + item);
	}
}
function popup_close(item, bodyUnlock = true) {
	if (unlock) {
		if (!item) {
			for (let index = 0; index < popups.length; index++) {
				const popup = popups[index];
				let video = popup.querySelector('.popup__video');
				if (video) {
					video.innerHTML = '';
				}
				popup.classList.remove('_active');
			}
		} else {
			let video = item.querySelector('.popup__video');
			if (video) {
				video.innerHTML = '';
			}
			item.classList.remove('_active');
		}
		if (!document.querySelector('.menu__body._active') && bodyUnlock) {
			body_lock_remove(500);
		}
		history.pushState('', '', window.location.href.split('#')[0]);
	}
}
let popup_close_icon = document.querySelectorAll('.popup__close,._popup-close');
if (popup_close_icon) {
	for (let index = 0; index < popup_close_icon.length; index++) {
		const el = popup_close_icon[index];
		el.addEventListener('click', function () {
			popup_close(el.closest('.popup'));
		})
	}
}
document.addEventListener('keydown', function (e) {
	if (e.code === 'Escape') {
		popup_close();
	}
});

//=================
//SlideToggle
let _slideUp = (target, duration = 500) => {
	if (!target.classList.contains('_slide')) {
		target.classList.add('_slide');
		target.style.transitionProperty = 'height, margin, padding';
		target.style.transitionDuration = duration + 'ms';
		target.style.height = target.offsetHeight + 'px';
		target.offsetHeight;
		target.style.overflow = 'hidden';
		target.style.height = 0;
		target.style.paddingTop = 0;
		target.style.paddingBottom = 0;
		target.style.marginTop = 0;
		target.style.marginBottom = 0;
		window.setTimeout(() => {
			target.hidden = true;
			target.style.removeProperty('height');
			target.style.removeProperty('padding-top');
			target.style.removeProperty('padding-bottom');
			target.style.removeProperty('margin-top');
			target.style.removeProperty('margin-bottom');
			target.style.removeProperty('overflow');
			target.style.removeProperty('transition-duration');
			target.style.removeProperty('transition-property');
			target.classList.remove('_slide');
		}, duration);
	}
}
let _slideDown = (target, duration = 500) => {
	if (!target.classList.contains('_slide')) {
		target.classList.add('_slide');
		if (target.hidden) {
			target.hidden = false;
		}
		let height = target.offsetHeight;
		target.style.overflow = 'hidden';
		target.style.height = 0;
		target.style.paddingTop = 0;
		target.style.paddingBottom = 0;
		target.style.marginTop = 0;
		target.style.marginBottom = 0;
		target.offsetHeight;
		target.style.transitionProperty = "height, margin, padding";
		target.style.transitionDuration = duration + 'ms';
		target.style.height = height + 'px';
		target.style.removeProperty('padding-top');
		target.style.removeProperty('padding-bottom');
		target.style.removeProperty('margin-top');
		target.style.removeProperty('margin-bottom');
		window.setTimeout(() => {
			target.style.removeProperty('height');
			target.style.removeProperty('overflow');
			target.style.removeProperty('transition-duration');
			target.style.removeProperty('transition-property');
			target.classList.remove('_slide');
		}, duration);
	}
}
let _slideToggle = (target, duration = 500) => {
	if (target.hidden) {
		return _slideDown(target, duration);
	} else {
		return _slideUp(target, duration);
	}
}
//========================================

//==RATING======================================
const ratings = document.querySelectorAll('.rating');
if (ratings.length > 0) {
	initRatings();
}
// Основная функция
function initRatings() {
	let ratingActive, ratingValue;
	// "Бегаем" по всем рейтингам на странице
	for (let index = 0; index < ratings.length; index++) {
		const rating = ratings[index];
		initRating(rating);
	}

	// Инициализируем конкретный рейтинг
	function initRating(rating) {
		initRatingVars(rating);

		setRatingActiveWidth();

		if (rating.classList.contains('rating_set')) {
			setRating(rating);
		}
	}

	// Инициализайция переменных
	function initRatingVars(rating) {
		ratingActive = rating.querySelector('.rating__active');
		ratingValue = rating.querySelector('.rating__value');
	}
	// Изменяем ширину активных звезд
	function setRatingActiveWidth(index = ratingValue.innerHTML) {
		const ratingActiveWidth = index / 0.05;
		ratingActive.style.width = `${ratingActiveWidth}%`;
	}
	// Возможность указать оценку 
	function setRating(rating) {
		const ratingItems = rating.querySelectorAll('.rating__item');
		for (let index = 0; index < ratingItems.length; index++) {
			const ratingItem = ratingItems[index];
			ratingItem.addEventListener("mouseenter", function (e) {
				// Обновление переменных
				initRatingVars(rating);
				// Обновление активных звезд
				setRatingActiveWidth(ratingItem.value);
			});
			ratingItem.addEventListener("mouseleave", function (e) {
				// Обновление активных звезд
				setRatingActiveWidth();
			});
			ratingItem.addEventListener("click", function (e) {
				// Обновление переменных
				initRatingVars(rating);

				if (rating.dataset.ajax) {
					// "Отправить" на сервер
					setRatingValue(ratingItem.value, rating);
				} else {
					// Отобразить указанную оцнку
					ratingValue.innerHTML = index + 1;
					setRatingActiveWidth();
				}
			});
		}
	}

	async function setRatingValue(value, rating) {
		if (!rating.classList.contains('rating_sending')) {
			rating.classList.add('rating_sending');

			// Отправика данных (value) на сервер
			let response = await fetch('rating.json', {
				method: 'GET',

				//body: JSON.stringify({
				//	userRating: value
				//}),
				//headers: {
				//	'content-type': 'application/json'
				//}

			});
			if (response.ok) {
				const result = await response.json();

				// Получаем новый рейтинг
				const newRating = result.newRating;

				// Вывод нового среднего результата
				ratingValue.innerHTML = newRating;

				// Обновление активных звезд
				setRatingActiveWidth();

				rating.classList.remove('rating_sending');
			} else {
				alert("Ошибка");

				rating.classList.remove('rating_sending');
			}
		}
	}
}
document.addEventListener('DOMContentLoaded', () => {

   //dropdown
   let dropDownAll = document.querySelectorAll("._dropdown");
   dropDownAll.forEach((item) => {
      const btn = item.querySelector('._dropdown-button');
      const itemActive = item.querySelector('._dropdown-body');
      if (btn && itemActive)
         btn.addEventListener("click", function () {
            itemActive.classList.toggle('_active');
            btn.classList.toggle('_active');
         })
   })

   document.addEventListener('click', documentActions);

   // calc btn down
   const calculator = document.querySelector('.calc-order');
   if (calculator) {
      const btnDown = calculator.querySelectorAll('.calc-order__down');
      btnDown.forEach((item) => {
         item.addEventListener('click', (e) => {
            const targetElement = e.target;
            const parentColumn = item.closest('.calc-order__column');
            const prevColumn = parentColumn.previousElementSibling;
            if (prevColumn && prevColumn.classList.contains('calc-order__column--hidden')) {
               prevColumn.classList.add('_show');
               targetElement.classList.add('_hidden');
            }
         })
      })
   }

   //Select
   let selects = document.getElementsByTagName('select');
   if (selects.length > 0) {
      selects_init();
   }

   //Select

   function selects_init() {
      for (let index = 0; index < selects.length; index++) {
         const select = selects[index];
         select_init(select);
      }
      //select_callback();
      document.addEventListener('click', function (e) {
         selects_close(e);
      });
      document.addEventListener('keydown', function (e) {
         if (e.code === 'Escape') {
            selects_close(e);
         }
      });
   }

   function selects_close(e) {
      const selects = document.querySelectorAll('.select');
      if (!e.target.closest('.select') && !e.target.classList.contains('_option')) {
         for (let index = 0; index < selects.length; index++) {
            const select = selects[index];
            const select_body_options = select.querySelector('.select__options');
            select.classList.remove('_active');
            _slideUp(select_body_options, 100);
         }
      }
   }

   function select_init(select) {
      const select_parent = select.parentElement;
      const select_modifikator = select.getAttribute('class');
      const select_selected_option = select.querySelector('option:checked');
      select.setAttribute('data-default', select_selected_option.value);
      select.style.display = 'none';

      select_parent.insertAdjacentHTML('beforeend', '<div class="select select_' + select_modifikator + '"></div>');

      let new_select = select.parentElement.querySelector('.select');
      new_select.appendChild(select);
      select_item(select);
   }

   function select_item(select) {
      const select_parent = select.parentElement;
      const select_items = select_parent.querySelector('.select__item');
      const select_options = select.querySelectorAll('option');
      const select_selected_option = select.querySelector('option:checked');
      const select_selected_text = select_selected_option.text;
      const select_type = select.getAttribute('data-type');

      if (select_items) {
         select_items.remove();
      }

      let select_type_content = '';
      if (select_type == 'input') {
         select_type_content = '<div class="select__value icon-select-arrow"><input autocomplete="off" type="text" name="form[]" value="' + select_selected_text + '" data-error="Ошибка" data-value="' + select_selected_text + '" class="select__input"></div>';
      } else {
         select_type_content = '<div class="select__value icon-select-arrow"><span>' + select_selected_text + '</span></div>';
      }

      select_parent.insertAdjacentHTML('beforeend',
         '<div class="select__item">' +
         '<div class="select__title">' + select_type_content + '</div>' +
         '<div hidden class="select__options">' + select_get_options(select_options) + '</div>' +
         '</div></div>');

      select_actions(select, select_parent);
   }

   function select_actions(original, select) {
      const select_item = select.querySelector('.select__item');
      const selectTitle = select.querySelector('.select__title');
      const select_body_options = select.querySelector('.select__options');
      const select_options = select.querySelectorAll('.select__option');
      const select_type = original.getAttribute('data-type');
      const select_input = select.querySelector('.select__input');

      selectTitle.addEventListener('click', function (e) {
         selectItemActions();
      });

      function selectMultiItems() {
         let selectedOptions = select.querySelectorAll('.select__option');
         let originalOptions = original.querySelectorAll('option');
         let selectedOptionsText = [];
         for (let index = 0; index < selectedOptions.length; index++) {
            const selectedOption = selectedOptions[index];
            originalOptions[index].removeAttribute('selected');
            if (selectedOption.classList.contains('_selected')) {
               const selectOptionText = selectedOption.innerHTML;
               selectedOptionsText.push(selectOptionText);
               originalOptions[index].setAttribute('selected', 'selected');
            }
         }
         select.querySelector('.select__value').innerHTML = '<span>' + selectedOptionsText + '</span>';
      }

      function selectItemActions(type) {
         if (!type) {
            let selects = document.querySelectorAll('.select');
            for (let index = 0; index < selects.length; index++) {
               const select = selects[index];
               const select_body_options = select.querySelector('.select__options');
               if (select != select_item.closest('.select')) {
                  select.classList.remove('_active');
                  _slideUp(select_body_options, 100);
               }
            }
            _slideToggle(select_body_options, 100);
            select.classList.toggle('_active');
         }
      }
      for (let index = 0; index < select_options.length; index++) {
         const select_option = select_options[index];
         const select_option_value = select_option.getAttribute('data-value');
         const select_option_text = select_option.innerHTML;

         if (select_type == 'input') {
            select_input.addEventListener('keyup', select_search);
         } else {
            if (select_option.getAttribute('data-value') == original.value && !original.hasAttribute('multiple')) {
               select_option.style.display = 'none';
            }
         }
         select_option.addEventListener('click', function () {
            for (let index = 0; index < select_options.length; index++) {
               const el = select_options[index];
               el.style.display = 'block';
            }
            if (select_type == 'input') {
               select_input.value = select_option_text;
               original.value = select_option_value;
            } else {
               if (original.hasAttribute('multiple')) {
                  select_option.classList.toggle('_selected');
                  selectMultiItems();
               } else {
                  select.querySelector('.select__value').innerHTML = '<span>' + select_option_text + '</span>';
                  original.value = select_option_value;
                  select_option.style.display = 'none';
               }
            }
            let type;
            if (original.hasAttribute('multiple')) {
               type = 'multiple';
            }
            selectItemActions(type);
         });
      }
   }

   function select_get_options(select_options) {
      if (select_options) {
         let select_options_content = '';
         for (let index = 0; index < select_options.length; index++) {
            const select_option = select_options[index];
            const select_option_value = select_option.value;
            if (select_option_value != '') {
               const select_option_text = select_option.innerHTML;
               select_options_content = select_options_content + '<div data-value="' + select_option_value + '" class="select__option">' + select_option_text + '</div>';
            }
         }
         return select_options_content;
      }
   }

   function select_search(e) {
      let select_block = e.target.closest('.select ').querySelector('.select__options');
      let select_options = e.target.closest('.select ').querySelectorAll('.select__option');
      let select_search_text = e.target.value.toUpperCase();

      for (let i = 0; i < select_options.length; i++) {
         let select_option = select_options[i];
         let select_txt_value = select_option.textContent || select_option.innerText;
         if (select_txt_value.toUpperCase().indexOf(select_search_text) > -1) {
            select_option.style.display = "";
         } else {
            select_option.style.display = "none";
         }
      }
   }

   function selects_update_all() {
      let selects = document.querySelectorAll('select');
      if (selects) {
         for (let index = 0; index < selects.length; index++) {
            const select = selects[index];
            select_item(select);
         }
      }
   }

   //QUANTITY
   let quantityButtons = document.querySelectorAll('.quantity__button');
   if (quantityButtons.length > 0) {
      for (let index = 0; index < quantityButtons.length; index++) {
         const quantityButton = quantityButtons[index];
         quantityButton.addEventListener("click", function (e) {
            let value = parseInt(quantityButton.closest('.quantity').querySelector('input').value);
            if (quantityButton.classList.contains('quantity__button_plus')) {
               value = value + 100;
            } else {
               value = value - 100;
               if (value < 100) {
                  value = 100
               }
            }
            quantityButton.closest('.quantity').querySelector('input').value = value;
         });
      }
   }

})



function documentActions(e) {
   const targetElement = e.target;
   const isContains = (item) => {
      return targetElement.classList.contains(item.toString());
   };

   // dropdown remove active
   if (document.querySelector('._dropdown ._active')) {
      if ((!isContains('._dropdown-head') || !targetElement.closest('._dropdown-head')) && !targetElement.closest('._dropdown')) {
         let dropDownAll = document.querySelectorAll("._dropdown");
         for (let i = 0; i < dropDownAll.length; i++) {
            const item = dropDownAll[i];
            const activeDropdown = item.querySelectorAll('._active');
            removeActive(activeDropdown);
         }
         return;
      }
   }



   //  Главное меню
   const mainNav = document.querySelector("header .header__nav");
   const iconMenu = document.querySelector(".icon-menu");
   const activeMunuItems = mainNav.querySelectorAll('._active');

   // Удаляем все классы ._active у меню если меню открыто
   if (document.querySelector('.header__nav._active')) {
      // если клик по icon-menu
      if (targetElement.classList.contains('icon-menu') || targetElement.closest('.icon-menu')) {
         // Удаляем у icon-menu
         iconMenu.classList.remove('_active');
         mainNav.classList.remove('_active');
         return;
         // если клик не по меню
      }
      if (!targetElement.closest('.header__nav')) {
         // Удаляем у icon-menu
         iconMenu.classList.remove('_active');
         mainNav.classList.remove('_active');
         return;
      }
   }

   if (targetElement.closest('header')) {
      // Добавляем класс ._active если клик по icon-menu
      if (targetElement.classList.contains('icon-menu') || targetElement.closest('.icon-menu')) {
         iconMenu.classList.add("_active");
         mainNav.classList.add("_active");
         return;
      }
   }
}

function removeActive(massive) {
   massive.forEach((item) => {
      item.classList.remove('_active');
   })
}
const sliders = document.querySelectorAll('.slider');

sliders.forEach((elem) => {
	const slider = elem.querySelector('.slider__body');
	const btnNext = elem.querySelector('.slider-nav-next');
	const btnPrev = elem.querySelector('.slider-nav-prev');
	// default breakpoints
	let breakpointsSlider = {
		320: {
			slidesPerView: 1,
			spaceBetween: 20,
		},
		600: {
			slidesPerView: 2,
			spaceBetween: 20,
		},
		992: {
			slidesPerView: 2,
			spaceBetween: 20,
		},
		1204: {
			slidesPerView: 3,
			spaceBetween: 32,
		},
	};

	// if slider work
	if (slider.classList.contains('slider__body--columns-four')) {
		breakpointsSlider = {
			320: {
				slidesPerView: 1,
				spaceBetween: 20,
			},
			600: {
				slidesPerView: 2,
				spaceBetween: 20,
			},
			992: {
				slidesPerView: 3,
				spaceBetween: 20,
			},
			1204: {
				slidesPerView: 4,
				spaceBetween: 23,
				watchOverflow: true,
			},
		};
	}

	new Swiper(slider, {
		observer: true,
		observeParents: true,
		slidesPerView: 1,
		spaceBetween: 0,
		speed: 800,
		navigation: {
			nextEl: btnNext,
			prevEl: btnPrev,
		},

		breakpoints: breakpointsSlider,
	});
});

// calc-order--cell-two
let calc_order = document.querySelectorAll('.calc-order');
calc_order.forEach((elem) => {
	let breakpoinst_calc;
	if (elem.classList.contains('calc-order--cell-two')) {
		breakpoinst_calc = {
			breakpoints: {
				320: {
					slidesPerView: 1,
					navigation: {
						nextEl: ".calc-order__btn-next-mob, .calc-order__btn-next",
						prevEl: ".calc-order__btn-down",
					},
				},
				650: {
					slidesPerView: 2,
					navigation: {
						nextEl: ".calc-order__btn-next",
						prevEl: ".calc-order__btn-down",
					},
				},
				1200: {
					watchOverflow: true,
					slidesPerView: 2,
					navigation: {
						nextEl: ".calc-order__btn-next",
						prevEl: ".calc-order__btn-down",
					},
				},
			}
		};
	} else {
		breakpoinst_calc = {
			breakpoints: {
				320: {
					slidesPerView: 1,
					navigation: {
						nextEl: ".calc-order__btn-next-mob, .calc-order__btn-next",
						prevEl: ".calc-order__btn-down",
					},
				},
				650: {
					slidesPerView: 2,
					navigation: {
						nextEl: ".calc-order__btn-next",
						prevEl: ".calc-order__btn-down",
					},
				},
				1200: {
					watchOverflow: true,
					slidesPerView: 3,
					navigation: {
						nextEl: ".calc-order__btn-next",
						prevEl: ".calc-order__btn-down",
					},
				},
			}
		};
	}


	new Swiper(elem, {
		/*
		effect: 'fade',
		autoplay: {
			delay: 3000,
			disableOnInteraction: false,
		},
		*/
		observer: true,
		observeParents: true,
		slidesPerView: 3,
		spaceBetween: 0,
		allowTouchMove: false,
		speed: 800,
		...breakpoinst_calc,

	});
})


const slidersCard = document.querySelectorAll('.slider-mob');
let sliderInitArray = [];

if (slidersCard) {
	mobileSlider();
	window.addEventListener('resize', mobileSlider);
}

function mobileSlider() {
	for (let i = 0; i < slidersCard.length; i++) {
		let width = 767;
		if (window.innerWidth <= width && sliderInitArray[i] === undefined) {
			const slider = slidersCard[i].querySelector('.swiper');
			const btnNext = slidersCard[i].querySelector('.slider-nav-next');
			const btnPrev = slidersCard[i].querySelector('.slider-nav-prev');
			let setting = {
				navigation: {
					nextEl: btnNext,
					prevEl: btnPrev,
				},
				breakpoints: {
					320: {
						slidesPerView: 1,
						spaceBetween: 20,
					},
				}
			};
			if (slider.classList.contains('slider-mob__body--fw')) {
				setting = {
					navigation: {
						nextEl: btnNext,
						prevEl: btnPrev,
					},
					breakpoints: {
						320: {
							slidesPerView: 1,
							slidesPerColumn: 2,
							spaceBetween: 20,
						},
					}
				};
			} else if (slider.classList.contains('slider-mob__body--column')) {
				setting = {
					navigation: {
						nextEl: btnNext,
						prevEl: btnPrev,
					},
					breakpoints: {
						320: {
							slidesPerView: 1,
							slidesPerColumn: 2,
							spaceBetween: 20,
						},
					}
				};
			}
			sliderInitArray[i] = sliderInit(slider, setting);
		}

		if (window.innerWidth > width && sliderInitArray[i] != undefined) {
			sliderInitArray[i] = sliderDestroy(sliderInitArray[i]);
		}
	}
}

function sliderInit(slider, setting) {
	const item = new Swiper(slider, {
		observer: true,
		observeParents: true,
		slidesPerView: 1,
		spaceBetween: 0,
		speed: 800,
		watchOverflow: true,
		...setting,
	});
	return item;
}

function sliderDestroy(slider) {
	let item = slider.destroy();
	item = undefined;
	return item;
}